#!/usr/bin/env sh

# Run unit tests first
echo "ğŸ§ª Running unit tests..."
if ! bun test; then
  echo "âŒ Unit tests failed. Please fix the errors above."
  exit 1
fi
echo "âœ… Unit tests passed!"

# Update coverage badge in README
echo "ğŸ“Š Updating coverage badge..."
bun scripts/update-coverage-badge.ts
if [ -f README.md ]; then
  git add README.md
fi

# Check dependency pinning
echo "ğŸ“Œ Checking dependency pinning..."
if ! sh scripts/check-dependency-pinning.sh; then
  echo "âŒ Dependency pinning check failed. Please fix the errors above."
  exit 1
fi

# Check for commented-out code
echo "ğŸ’¬ Checking for commented-out code..."
if ! sh scripts/check-commented-code.sh; then
  echo "âŒ Commented-out code check failed. Please fix the errors above."
  exit 1
fi

# Check eslint-disable comments
echo "ğŸ”§ Checking eslint-disable comments..."
if ! sh scripts/check-eslint-disable.sh; then
  echo "âŒ ESLint disable check failed. Please fix the errors above."
  exit 1
fi

# Run lint-staged with better error handling
echo "ğŸ” Running pre-commit checks..."
if ! bunx lint-staged; then
  echo "âŒ Pre-commit checks failed. Please fix the errors above."
  exit 1
fi

echo "âœ… Pre-commit checks passed!"
